<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.green.board.mapper.BoardMapper">
	
	<!-- 하나의 게시글 작성하여 추가하는 쿼리문 -->
	<insert id="insertBoard" parameterType="BoardDTO">
		INSERT INTO board(writer, subject, writerPw, content, id) VALUES(#{writer}, #{subject}, #{writerPw}, #{content}, #{id})
	</insert>
	
	<!-- 전체 게시글 목록을 출력하는 쿼리문 -->
	<select id="getAllBoard" resultType="BoardDTO">
		SELECT * FROM board ORDER BY num DESC
	</select>
	
	<!-- 하나의 게시글 조회수 1 증가 -->
	<update id="getOneBoardUpdate" parameterType="int">
		UPDATE board SET readcount = readcount + 1 WHERE num = #{num}
	</update>
	
	<!-- 하나의 게시글 상세정보 보기 -->
	<select id="getOneBoardSelect" resultType="BoardDTO" parameterType="int">
		SELECT * FROM board WHERE num = #{num}
	</select>
	
	<!-- 검색 버튼 클릭시 검색어가 포함된 게시글 select -->
	<!-- @Param("searchType") String searchType, @Param("searchKeyWord") String searchKeyWord =====> 매퍼에서 @Param으로 매개변수 값을 받은 경우 SQL문에서 매개변수를 생략한다. -->
	<select id="getSearchBoard" resultType="BoardDTO">
		SELECT * FROM board
		<where>
			<!-- <when test="조건식"></when> -->
			<choose>
				<when test="searchType == 'subject'">
					<!-- subject LIKE "%"searchKeyWord"%" -->
					subject LIKE CONCAT("%", #{searchKeyWord},"%")
				</when>
				<otherwise>
					content LIKE CONCAT("%", #{searchKeyWord},"%")
				</otherwise>
			</choose>
		</where>
		ORDER BY num DESC
	</select>
	
	<!-- 하나의 게시글을 수정하는 메서드 -->
	<update id="updateBoard" parameterType="BoardDTO">
		UPDATE board SET subject = #{subject}, content = #{content} WHERE num = #{num} AND writerPw=#{writerPw}
	</update>
	
	<!-- 하나의 게시글을 삭제하는 메서드 -->
	<!-- @Param("num") int num, @Param("writerPw") String writerPw =====> 매퍼에서 @Param으로 매개변수 값을 받은 경우 SQL문에서 매개변수를 생략한다. -->
	<delete id="deleteBoard">
		DELETE FROM board WHERE num=#{num} AND writerPw=#{writerPw}
	</delete>
</mapper>